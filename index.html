<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>贪吃蛇游戏</title>
  <style>
    /*—— 整体背景 ——*/
    body {
      margin: 0;
      padding: 0;
      background-color: #f0f8ff; /* 浅蓝背景 */
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    /*—— 难度选择屏幕 ——*/
    #difficulty-screen {
      background-color: #ffffff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      width: 360px;
      padding: 24px;
      text-align: center;
    }
    #difficulty-screen .title {
      font-size: 24px;
      font-weight: bold;
      color: #1B36C0;
      margin-bottom: 16px;
    }
    #difficulty-screen .buttons {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-top: 12px;
    }
    #difficulty-screen .buttons button {
      flex: 1;
      padding: 10px 0;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      color: #ffffff;
      outline: none;
    }
    #easyBtn {
      background-color: #28a745; /* 绿色 - 简单 */
    }
    #mediumBtn {
      background-color: #ffc107; /* 黄色 - 中等 */
    }
    #hardBtn {
      background-color: #dc3545; /* 红色 - 困难 */
    }

    /*—— 游戏容器（初始设为隐藏，待选完难度后显示） ——*/
    .container {
      display: none;
      background-color: #ffffff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      width: 480px;
      padding: 20px;
    }

    /*—— 标题 & 得分 ——*/
    .container .title {
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      color: #1B36C0;
    }
    .container .score {
      margin-top: 10px;
      font-size: 18px;
      color: #333333;
    }

    /*—— 暂停 & 重新开始 按钮 ——*/
    .container .controls {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 10px;
    }
    .container .controls button {
      border: none;
      border-radius: 4px;
      padding: 6px 12px;
      font-size: 14px;
      cursor: pointer;
      color: #ffffff;
      outline: none;
    }
    #pauseBtn {
      background-color: #FFC107; /* 黄色 */
    }
    #resetBtn {
      background-color: #1B36C0; /* 深蓝色 */
    }

    /*—— 游戏图例：红色/黄色食物 ——*/
    .container .legend {
      margin-top: 15px;
      font-size: 14px;
      color: #333333;
    }
    .container .legend-item {
      display: flex;
      align-items: center;
      margin-top: 5px;
    }
    .container .legend-item .color-box {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 6px;
      display: inline-block;
    }

    /*—— 游戏区域（16×16） ——*/
    .container .game-area {
      margin-top: 15px;
      background-color: #1B36C0; /* 深蓝背景 */
      border-radius: 8px;
      position: relative;
      width: 400px;  /* 固定物理像素宽度 */
      height: 400px; /* 固定物理像素高度 */
      margin-left: auto;
      margin-right: auto;
      box-shadow: inset 0 0 0 2px rgba(0,0,0,0.1);
    }
    #gameCanvas {
      display: block;
      background-color: transparent;
      margin: 0 auto;
      width: 400px;  /* 与 .game-area 同步 */
      height: 400px; /* 与 .game-area 同步 */
    }

    /*—— 方向按钮区 ——*/
    .container .arrow-controls {
      margin-top: 15px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .container .arrow-controls .row {
      display: flex;
      justify-content: center;
    }
    .container .arrow-controls button {
      width: 60px;
      height: 60px;
      margin: 5px;
      border: none;
      border-radius: 6px;
      background-color: #E0E0E0;
      font-size: 24px;
      cursor: pointer;
      outline: none;
      user-select: none;
    }
  </style>
</head>
<body>
  <!-- 难度选择屏幕 -->
  <div id="difficulty-screen">
    <div class="title">选择游戏难度</div>
    <div>简单：蛇速慢；中等：蛇速适中；困难：蛇速快</div>
    <div class="buttons">
      <button id="easyBtn">简单</button>
      <button id="mediumBtn">中等</button>
      <button id="hardBtn">困难</button>
    </div>
  </div>

  <!-- 游戏主体 容器（默认隐藏） -->
  <div class="container">
    <!-- 标题 -->
    <div class="title">贪吃蛇游戏</div>
    <!-- 得分 -->
    <div class="score">得分: <span id="score">0</span></div>
    <!-- 暂停 & 重新开始 -->
    <div class="controls">
      <button id="pauseBtn">暂停</button>
      <button id="resetBtn">重新开始</button>
    </div>
    <!-- 食物图例 -->
    <div class="legend">
      <div class="legend-item">
        <span class="color-box" style="background-color: red;"></span>
        普通食物 - 得1分
      </div>
      <div class="legend-item">
        <span class="color-box" style="background-color: yellow;"></span>
        特殊食物 - 得3分 (8秒后消失)
      </div>
    </div>
    <!-- 游戏区域 -->
    <div class="game-area">
      <canvas id="gameCanvas" width="400" height="400"></canvas>
    </div>
    <!-- 方向按钮（空 上 空 / 左 下 右）-->
    <div class="arrow-controls">
      <div class="row">
        <button id="upBtn">↑</button>
      </div>
      <div class="row">
        <button id="leftBtn">←</button>
        <button id="downBtn">↓</button>
        <button id="rightBtn">→</button>
      </div>
    </div>
  </div>

  <script>
    /***** 全局配置（按新需求改为16×16） *****/
    const ROWS = 16;
    const COLS = 16;

    /***** 页面元素引用 *****/
    const difficultyScreen = document.getElementById('difficulty-screen');
    const easyBtn   = document.getElementById('easyBtn');
    const mediumBtn = document.getElementById('mediumBtn');
    const hardBtn   = document.getElementById('hardBtn');

    const container = document.querySelector('.container');
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreElem = document.getElementById('score');
    const pauseBtn = document.getElementById('pauseBtn');
    const resetBtn = document.getElementById('resetBtn');

    const upBtn    = document.getElementById('upBtn');
    const downBtn  = document.getElementById('downBtn');
    const leftBtn  = document.getElementById('leftBtn');
    const rightBtn = document.getElementById('rightBtn');

    /***** 动态变量 *****/
    let snake = [];               // 蛇身坐标数组
    let direction = { x: 1, y: 0 }; // 初始方向：向右
    let food = null;              // 普通食物坐标
    let specialFood = null;       // 特殊食物坐标
    let specialTimeout = null;    // 特殊食物消失计时器
    let score = 0;                // 当前得分
    let gameInterval = null;      // 主循环定时器
    let intervalTime = 150;       // 默认帧间隔（会根据难度设置）
    let paused = false;           // 暂停状态标志

    // CELL_SIZE 会随着 canvas.width / COLS 自动计算。现在是 400/16 = 25px
    const CELL_SIZE = canvas.width / COLS;

    /***** 难度按钮 点击事件 *****/
    easyBtn.addEventListener('click', () => selectDifficulty(200));
    mediumBtn.addEventListener('click', () => selectDifficulty(150));
    hardBtn.addEventListener('click', () => selectDifficulty(100));

    function selectDifficulty(chosenInterval) {
      // 1. 设置帧间隔
      intervalTime = chosenInterval;
      // 2. 隐藏难度选择屏，显示游戏容器
      difficultyScreen.style.display = 'none';
      container.style.display = 'block';
      // 3. 初始化游戏
      initGame();
    }

    /***** 初始化游戏 *****/
    function initGame() {
      // 如果之前有计时器，先清除
      if (gameInterval) clearInterval(gameInterval);
      if (specialTimeout) clearTimeout(specialTimeout);

      // 重置蛇身：长度3，放在画布中央
      snake = [];
      const startX = Math.floor(COLS / 2);
      const startY = Math.floor(ROWS / 2);
      for (let i = 0; i < 3; i++) {
        snake.push({ x: startX - i, y: startY });
      }
      direction = { x: 1, y: 0 }; // 初始向右

      // 分数归零
      score = 0;
      scoreElem.textContent = score;

      // 生成一个普通食物
      spawnFood();
      specialFood = null;

      paused = false;
      pauseBtn.textContent = '暂停';

      // 启动主循环
      gameInterval = setInterval(gameLoop, intervalTime);
      // 安排特殊食物随机出现
      scheduleSpecialSpawn();
    }

    /***** 生成普通食物 *****/
    function spawnFood() {
      let valid = false;
      let x, y;
      while (!valid) {
        x = Math.floor(Math.random() * COLS);
        y = Math.floor(Math.random() * ROWS);
        valid = !snake.some(seg => seg.x === x && seg.y === y);
      }
      food = { x, y };
    }

    /***** 生成特殊食物 & 8秒后消失 *****/
    function spawnSpecialFood() {
      if (specialFood) return;
      let valid = false;
      let x, y;
      while (!valid) {
        x = Math.floor(Math.random() * COLS);
        y = Math.floor(Math.random() * ROWS);
        valid = 
          !snake.some(seg => seg.x === x && seg.y === y) &&
          !(food && food.x === x && food.y === y);
      }
      specialFood = { x, y };
      specialTimeout = setTimeout(() => {
        specialFood = null;
        specialTimeout = null;
      }, 8000);
    }

    /***** 随机安排下一次特殊食物出现 *****/
    function scheduleSpecialSpawn() {
      const t = 12000 + Math.random() * 6000;
      setTimeout(() => {
        if (!specialFood) spawnSpecialFood();
        scheduleSpecialSpawn();
      }, t);
    }

    /***** 游戏主循环 *****/
    function gameLoop() {
      if (paused) return;

      // 计算新蛇头
      const head = {
        x: snake[0].x + direction.x,
        y: snake[0].y + direction.y
      };

      // 边界检测
      if (head.x < 0 || head.x >= COLS || head.y < 0 || head.y >= ROWS) {
        return gameOver();
      }
      // 自身碰撞检测
      if (snake.some(seg => seg.x === head.x && seg.y === head.y)) {
        return gameOver();
      }

      snake.unshift(head);

      // 吃普通食物
      if (food && head.x === food.x && head.y === food.y) {
        score += 1;
        scoreElem.textContent = score;
        spawnFood();
      }
      // 吃特殊食物
      else if (specialFood && head.x === specialFood.x && head.y === specialFood.y) {
        score += 3;
        scoreElem.textContent = score;
        clearTimeout(specialTimeout);
        specialFood = null;
        specialTimeout = null;
      }
      // 正常移动，不增长
      else {
        snake.pop();
      }

      // 重绘
      drawAll();
    }

    /***** 绘制所有元素 *****/
    function drawAll() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // （可选）绘制网格线，若不需要可注释
      // ctx.strokeStyle = 'rgba(255,255,255,0.1)';
      // for (let i = 0; i <= ROWS; i++) {
      //   ctx.beginPath();
      //   ctx.moveTo(0, i * CELL_SIZE);
      //   ctx.lineTo(canvas.width, i * CELL_SIZE);
      //   ctx.stroke();
      // }
      // for (let j = 0; j <= COLS; j++) {
      //   ctx.beginPath();
      //   ctx.moveTo(j * CELL_SIZE, 0);
      //   ctx.lineTo(j * CELL_SIZE, canvas.height);
      //   ctx.stroke();
      // }

      // 画普通食物（红色圆）
      if (food) {
        ctx.fillStyle = 'red';
        ctx.beginPath();
        ctx.arc(
          food.x * CELL_SIZE + CELL_SIZE / 2,
          food.y * CELL_SIZE + CELL_SIZE / 2,
          CELL_SIZE / 2 - 2,
          0, Math.PI * 2
        );
        ctx.fill();
      }

      // 画特殊食物（黄色圆）
      if (specialFood) {
        ctx.fillStyle = 'yellow';
        ctx.beginPath();
        ctx.arc(
          specialFood.x * CELL_SIZE + CELL_SIZE / 2,
          specialFood.y * CELL_SIZE + CELL_SIZE / 2,
          CELL_SIZE / 2 - 2,
          0, Math.PI * 2
        );
        ctx.fill();
      }

      // 画蛇身（绿色方块）
      ctx.fillStyle = '#00C27A';
      snake.forEach(seg => {
        ctx.fillRect(
          seg.x * CELL_SIZE + 2,
          seg.y * CELL_SIZE + 2,
          CELL_SIZE - 4,
          CELL_SIZE - 4
        );
      });
    }

    /***** 游戏结束 *****/
    function gameOver() {
      clearInterval(gameInterval);
      if (specialTimeout) clearTimeout(specialTimeout);
      alert('💥 游戏结束！你的得分：' + score);
    }

    /***** 方向切换（防止瞬间反向调头） *****/
    function changeDirection(newDir) {
      if ((newDir.x === -direction.x && newDir.y === 0) ||
          (newDir.y === -direction.y && newDir.x === 0)) {
        return;
      }
      direction = newDir;
    }

    /***** 键盘监听 *****/
    document.addEventListener('keydown', e => {
      switch (e.key) {
        case 'ArrowUp':
        case 'w':
        case 'W':
          changeDirection({ x: 0, y: -1 });
          break;
        case 'ArrowDown':
        case 's':
        case 'S':
          changeDirection({ x: 0, y: 1 });
          break;
        case 'ArrowLeft':
        case 'a':
        case 'A':
          changeDirection({ x: -1, y: 0 });
          break;
        case 'ArrowRight':
        case 'd':
        case 'D':
          changeDirection({ x: 1, y: 0 });
          break;
      }
    });

    /***** 页面方向按钮 *****/
    upBtn.addEventListener('click',    () => changeDirection({ x: 0, y: -1 }));
    downBtn.addEventListener('click',  () => changeDirection({ x: 0, y: 1 }));
    leftBtn.addEventListener('click',  () => changeDirection({ x: -1, y: 0 }));
    rightBtn.addEventListener('click', () => changeDirection({ x: 1, y: 0 }));

    /***** 暂停 / 继续 —— 需弹窗提示 *****/
    pauseBtn.addEventListener('click', () => {
      if (!paused) {
        // 暂停
        paused = true;
        clearInterval(gameInterval);
        pauseBtn.textContent = '继续';
        alert('⏸️ 游戏已暂停');
      } else {
        // 继续
        paused = false;
        pauseBtn.textContent = '暂停';
        alert('▶️ 游戏继续');
        gameInterval = setInterval(gameLoop, intervalTime);
      }
    });

    /***** 重新开始 *****/
    resetBtn.addEventListener('click', () => {
      initGame();
    });

    // 不再有速度按钮，弃用原先的 speedButtons 逻辑

  </script>
</body>
</html>
