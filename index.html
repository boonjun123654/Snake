<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>è´ªåƒè›‡æ¸¸æˆ</title>
  <style>
    /*â€”â€” æ•´ä½“èƒŒæ™¯ â€”â€”*/
    body {
      margin: 0;
      padding: 0;
      background-color: #f0f8ff; /* æµ…è“èƒŒæ™¯ */
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      position: relative; /* ä¾¿äºå­å…ƒç´ å®šä½ */
    }

    /*â€”â€” éš¾åº¦é€‰æ‹©å±å¹• â€”â€”*/
    #difficulty-screen {
      background-color: #ffffff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      width: 360px;
      padding: 24px;
      text-align: center;
      z-index: 10;
    }
    #difficulty-screen .title {
      font-size: 24px;
      font-weight: bold;
      color: #1B36C0;
      margin-bottom: 16px;
    }
    #difficulty-screen .buttons {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-top: 12px;
    }
    #difficulty-screen .buttons button {
      flex: 1;
      padding: 10px 0;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      color: #ffffff;
      outline: none;
    }
    #easyBtn {
      background-color: #28a745; /* ç»¿è‰² - ç®€å• */
    }
    #mediumBtn {
      background-color: #ffc107; /* é»„è‰² - ä¸­ç­‰ */
    }
    #hardBtn {
      background-color: #dc3545; /* çº¢è‰² - å›°éš¾ */
    }

    /*â€”â€” æ¸¸æˆå®¹å™¨ï¼ˆåˆå§‹éšè—ï¼Œå¾…é€‰å®Œéš¾åº¦åæ˜¾ç¤ºï¼‰ â€”â€”*/
    .container {
      display: none;
      background-color: #ffffff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      width: 480px;
      padding: 20px;
      position: relative;
      z-index: 1;
    }

    /*â€”â€” æ ‡é¢˜ & å¾—åˆ† â€”â€”*/
    .container .title {
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      color: #1B36C0;
    }
    .container .score {
      margin-top: 10px;
      font-size: 18px;
      color: #333333;
    }

    /*â€”â€” æš‚åœ æŒ‰é’® â€”â€”*/
    .container .controls {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 10px;
    }
    .container .controls button {
      border: none;
      border-radius: 4px;
      padding: 6px 12px;
      font-size: 14px;
      cursor: pointer;
      color: #ffffff;
      outline: none;
    }
    #pauseBtn {
      background-color: #FFC107; /* é»„è‰² */
    }
    /* å·²å–æ¶ˆâ€œé‡æ–°å¼€å§‹â€æŒ‰é’®ï¼Œåˆ é™¤å…¶ CSS */

    /*â€”â€” æ¸¸æˆå›¾ä¾‹ï¼šçº¢è‰²/é»„è‰²é£Ÿç‰© â€”â€”*/
    .container .legend {
      margin-top: 15px;
      font-size: 14px;
      color: #333333;
    }
    .container .legend-item {
      display: flex;
      align-items: center;
      margin-top: 5px;
    }
    .container .legend-item .color-box {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 6px;
      display: inline-block;
    }

    /*â€”â€” æ¸¸æˆåŒºåŸŸï¼ˆ16Ã—16ï¼‰ â€”â€”*/
    .container .game-area {
      margin-top: 15px;
      background-color: #1B36C0; /* æ·±è“èƒŒæ™¯ */
      border-radius: 8px;
      position: relative;
      width: 300px;  /* å›ºå®šç‰©ç†åƒç´ å®½åº¦ */
      height: 300px; /* å›ºå®šç‰©ç†åƒç´ é«˜åº¦ */
      margin-left: auto;
      margin-right: auto;
      box-shadow: inset 0 0 0 2px rgba(0,0,0,0.1);
    }
    #gameCanvas {
      display: block;
      background-color: transparent;
      margin: 0 auto;
      width: 400px;  /* ä¸ .game-area åŒæ­¥ */
      height: 400px; /* ä¸ .game-area åŒæ­¥ */
    }

    /*â€”â€” æ–¹å‘æŒ‰é’®åŒº â€”â€”*/
    .container .arrow-controls {
      margin-top: 15px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .container .arrow-controls .row {
      display: flex;
      justify-content: center;
    }
    .container .arrow-controls button {
      width: 60px;
      height: 60px;
      margin: 5px;
      border: none;
      border-radius: 6px;
      background-color: #E0E0E0;
      font-size: 24px;
      cursor: pointer;
      outline: none;
      user-select: none;
    }

    /*â€”â€” æ¨¡æ€æ¡†é€šç”¨æ ·å¼ â€”â€”*/
    .modal-overlay {
      display: none; /* é»˜è®¤éšè— */
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
      z-index: 20;
    }
    .modal-content {
      background: #ffffff;
      border-radius: 8px;
      padding: 20px;
      width: 300px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .modal-content p {
      margin-bottom: 16px;
      font-size: 18px;
      color: #333333;
    }
    .modal-content button {
      margin: 5px;
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      outline: none;
      background-color: #1B36C0;
      color: #ffffff;
    }
    .modal-content button[data-speed="200"] {
      background-color: #28a745; /* ç»¿è‰² ï¼ æ…¢ */
    }
    .modal-content button[data-speed="150"] {
      background-color: #ffc107; /* é»„è‰² ï¼ ä¸­ */
    }
    .modal-content button[data-speed="100"] {
      background-color: #dc3545; /* çº¢è‰² ï¼ å¿« */
    }
    .modal-content button#resumeBtn {
      background-color: #28a745; /* ç»¿è‰²â€œç»§ç»­æ¸¸æˆâ€ */
    }
  </style>
</head>
<body>
  <!-- éš¾åº¦é€‰æ‹©å±å¹• -->
  <div id="difficulty-screen">
    <div class="title">é€‰æ‹©æ¸¸æˆéš¾åº¦</div>
    <div>ç®€å•ï¼šè›‡é€Ÿæ…¢ï¼›ä¸­ç­‰ï¼šè›‡é€Ÿé€‚ä¸­ï¼›å›°éš¾ï¼šè›‡é€Ÿå¿«</div>
    <div class="buttons">
      <button id="easyBtn">ç®€å•</button>
      <button id="mediumBtn">ä¸­ç­‰</button>
      <button id="hardBtn">å›°éš¾</button>
    </div>
  </div>

  <!-- æ¸¸æˆä¸»ä½“ å®¹å™¨ï¼ˆé»˜è®¤éšè—ï¼‰ -->
  <div class="container">
    <!-- æ ‡é¢˜ -->
    <div class="title">è´ªåƒè›‡æ¸¸æˆ</div>
    <!-- å¾—åˆ† -->
    <div class="score">å¾—åˆ†: <span id="score">0</span></div>
    <!-- æš‚åœ æŒ‰é’® -->
    <div class="controls">
      <button id="pauseBtn">æš‚åœ</button>
    </div>
    <!-- é£Ÿç‰©å›¾ä¾‹ -->
    <div class="legend">
      <div class="legend-item">
        <span class="color-box" style="background-color: red;"></span>
        æ™®é€šé£Ÿç‰© - å¾—1åˆ†
      </div>
      <div class="legend-item">
        <span class="color-box" style="background-color: yellow;"></span>
        ç‰¹æ®Šé£Ÿç‰© - å¾—3åˆ† (8ç§’åæ¶ˆå¤±)
      </div>
    </div>
    <!-- æ¸¸æˆåŒºåŸŸ -->
    <div class="game-area">
      <canvas id="gameCanvas" width="300" height="300"></canvas>
    </div>
    <!-- æ–¹å‘æŒ‰é’®ï¼ˆç©º ä¸Š ç©º / å·¦ ä¸‹ å³ï¼‰-->
    <div class="arrow-controls">
      <div class="row">
        <button id="upBtn">â†‘</button>
      </div>
      <div class="row">
        <button id="leftBtn">â†</button>
        <button id="downBtn">â†“</button>
        <button id="rightBtn">â†’</button>
      </div>
    </div>
  </div>

  <!-- æš‚åœæ¨¡æ€æ¡† -->
  <div id="pauseModal" class="modal-overlay">
    <div class="modal-content">
      <p>â¸ï¸ æ¸¸æˆå·²æš‚åœ</p>
      <button id="resumeBtn">ç»§ç»­æ¸¸æˆ</button>
    </div>
  </div>

  <!-- æ¸¸æˆç»“æŸæ¨¡æ€æ¡† -->
  <div id="gameOverModal" class="modal-overlay">
    <div class="modal-content">
      <p id="gameOverText">ğŸ’¥ æ¸¸æˆç»“æŸï¼ä½ çš„å¾—åˆ†ï¼š0</p>
      <p>é‡æ–°æ¥å¤šä¸€å±€ï¼Ÿ</p>
      <button data-speed="200">æ…¢</button>
      <button data-speed="150">ä¸­</button>
      <button data-speed="100">å¿«</button>
    </div>
  </div>

  <script>
    /***** å…¨å±€é…ç½®ï¼ˆæŒ‰æ–°éœ€æ±‚æ”¹ä¸º16Ã—16ï¼‰ *****/
    const ROWS = 16;
    const COLS = 16;

    /***** é¡µé¢å…ƒç´ å¼•ç”¨ *****/
    const difficultyScreen = document.getElementById('difficulty-screen');
    const easyBtn   = document.getElementById('easyBtn');
    const mediumBtn = document.getElementById('mediumBtn');
    const hardBtn   = document.getElementById('hardBtn');

    const container = document.querySelector('.container');
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreElem = document.getElementById('score');
    const pauseBtn = document.getElementById('pauseBtn');

    const upBtn    = document.getElementById('upBtn');
    const downBtn  = document.getElementById('downBtn');
    const leftBtn  = document.getElementById('leftBtn');
    const rightBtn = document.getElementById('rightBtn');

    const pauseModal = document.getElementById('pauseModal');
    const resumeBtn  = document.getElementById('resumeBtn');
    const gameOverModal = document.getElementById('gameOverModal');
    const gameOverText  = document.getElementById('gameOverText');

    /***** åŠ¨æ€å˜é‡ *****/
    let snake = [];               // è›‡èº«åæ ‡æ•°ç»„
    let direction = { x: 1, y: 0 }; // åˆå§‹æ–¹å‘ï¼šå‘å³
    let food = null;              // æ™®é€šé£Ÿç‰©åæ ‡
    let specialFood = null;       // ç‰¹æ®Šé£Ÿç‰©åæ ‡
    let specialTimeout = null;    // ç‰¹æ®Šé£Ÿç‰©æ¶ˆå¤±è®¡æ—¶å™¨
    let score = 0;                // å½“å‰å¾—åˆ†
    let gameInterval = null;      // ä¸»å¾ªç¯å®šæ—¶å™¨
    let intervalTime = 150;       // å¸§é—´éš”ï¼ˆæ ¹æ®éš¾åº¦è°ƒæ•´ï¼‰
    let paused = false;           // æš‚åœçŠ¶æ€æ ‡å¿—

    // æ¯ä¸ªæ ¼å­çš„åƒç´ å¤§å°ï¼š400 / 16 = 25px
    const CELL_SIZE = canvas.width / COLS;

    /***** éš¾åº¦æŒ‰é’® ç‚¹å‡»äº‹ä»¶ *****/
    easyBtn.addEventListener('click', () => selectDifficulty(200));
    mediumBtn.addEventListener('click', () => selectDifficulty(150));
    hardBtn.addEventListener('click', () => selectDifficulty(100));

    function selectDifficulty(chosenInterval) {
      // 1. è®¾ç½®å¸§é—´éš”
      intervalTime = chosenInterval;
      // 2. éšè—éš¾åº¦é€‰æ‹©å±ï¼Œæ˜¾ç¤ºæ¸¸æˆå®¹å™¨
      difficultyScreen.style.display = 'none';
      container.style.display = 'block';
      // 3. åˆå§‹åŒ–æ¸¸æˆ
      initGame();
    }

    /***** åˆå§‹åŒ–æ¸¸æˆ *****/
    function initGame() {
      // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
      if (gameInterval) clearInterval(gameInterval);
      if (specialTimeout) clearTimeout(specialTimeout);

      // é‡ç½®è›‡èº«ï¼šé•¿åº¦3ï¼Œæ”¾åœ¨ç”»å¸ƒä¸­å¤®
      snake = [];
      const startX = Math.floor(COLS / 2);
      const startY = Math.floor(ROWS / 2);
      for (let i = 0; i < 3; i++) {
        snake.push({ x: startX - i, y: startY });
      }
      direction = { x: 1, y: 0 }; // åˆå§‹å‘å³

      // åˆ†æ•°å½’é›¶
      score = 0;
      scoreElem.textContent = score;

      // ç”Ÿæˆä¸€ä¸ªæ™®é€šé£Ÿç‰©
      spawnFood();
      specialFood = null;

      paused = false;
      pauseBtn.textContent = 'æš‚åœ';

      // éšè—ä»»ä½•å¯èƒ½æ®‹ç•™çš„æ¨¡æ€æ¡†
      pauseModal.style.display = 'none';
      gameOverModal.style.display = 'none';

      // å¯åŠ¨ä¸»å¾ªç¯
      gameInterval = setInterval(gameLoop, intervalTime);
      // å®‰æ’ç‰¹æ®Šé£Ÿç‰©éšæœºå‡ºç°
      scheduleSpecialSpawn();
    }

    /***** ç”Ÿæˆæ™®é€šé£Ÿç‰© *****/
    function spawnFood() {
      let valid = false;
      let x, y;
      while (!valid) {
        x = Math.floor(Math.random() * COLS);
        y = Math.floor(Math.random() * ROWS);
        valid = !snake.some(seg => seg.x === x && seg.y === y);
      }
      food = { x, y };
    }

    /***** ç”Ÿæˆç‰¹æ®Šé£Ÿç‰© & 8ç§’åæ¶ˆå¤± *****/
    function spawnSpecialFood() {
      if (specialFood) return;
      let valid = false;
      let x, y;
      while (!valid) {
        x = Math.floor(Math.random() * COLS);
        y = Math.floor(Math.random() * ROWS);
        valid =
          !snake.some(seg => seg.x === x && seg.y === y) &&
          !(food && food.x === x && food.y === y);
      }
      specialFood = { x, y };
      specialTimeout = setTimeout(() => {
        specialFood = null;
        specialTimeout = null;
      }, 8000);
    }

    /***** éšæœºå®‰æ’ä¸‹ä¸€æ¬¡ç‰¹æ®Šé£Ÿç‰©å‡ºç° *****/
    function scheduleSpecialSpawn() {
      const t = 12000 + Math.random() * 6000;
      setTimeout(() => {
        if (!specialFood) spawnSpecialFood();
        scheduleSpecialSpawn();
      }, t);
    }

    /***** æ¸¸æˆä¸»å¾ªç¯ *****/
    function gameLoop() {
      if (paused) return;

      // è®¡ç®—æ–°è›‡å¤´
      const head = {
        x: snake[0].x + direction.x,
        y: snake[0].y + direction.y
      };

      // è¾¹ç•Œæ£€æµ‹
      if (head.x < 0 || head.x >= COLS || head.y < 0 || head.y >= ROWS) {
        return gameOver();
      }
      // è‡ªèº«ç¢°æ’æ£€æµ‹
      if (snake.some(seg => seg.x === head.x && seg.y === head.y)) {
        return gameOver();
      }

      snake.unshift(head);

      // åƒæ™®é€šé£Ÿç‰©
      if (food && head.x === food.x && head.y === food.y) {
        score += 1;
        scoreElem.textContent = score;
        spawnFood();
      }
      // åƒç‰¹æ®Šé£Ÿç‰©
      else if (specialFood && head.x === specialFood.x && head.y === specialFood.y) {
        score += 3;
        scoreElem.textContent = score;
        clearTimeout(specialTimeout);
        specialFood = null;
        specialTimeout = null;
      }
      // æ­£å¸¸ç§»åŠ¨ï¼Œä¸å¢é•¿
      else {
        snake.pop();
      }

      // é‡ç»˜
      drawAll();
    }

    /***** ç»˜åˆ¶æ‰€æœ‰å…ƒç´ ï¼ˆå«åœ†è§’è›‡èº«ï¼‰ *****/
    function drawAll() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // ç”»æ™®é€šé£Ÿç‰©ï¼ˆçº¢è‰²åœ†ï¼‰
      if (food) {
        ctx.fillStyle = 'red';
        ctx.beginPath();
        ctx.arc(
          food.x * CELL_SIZE + CELL_SIZE / 2,
          food.y * CELL_SIZE + CELL_SIZE / 2,
          CELL_SIZE / 2 - 2,
          0, Math.PI * 2
        );
        ctx.fill();
      }

      // ç”»ç‰¹æ®Šé£Ÿç‰©ï¼ˆé»„è‰²åœ†ï¼‰
      if (specialFood) {
        ctx.fillStyle = 'yellow';
        ctx.beginPath();
        ctx.arc(
          specialFood.x * CELL_SIZE + CELL_SIZE / 2,
          specialFood.y * CELL_SIZE + CELL_SIZE / 2,
          CELL_SIZE / 2 - 2,
          0, Math.PI * 2
        );
        ctx.fill();
      }

      // ç”»è›‡èº«ï¼ˆåœ†è§’æ–¹å—ï¼‰
      ctx.fillStyle = '#00C27A';
      snake.forEach(seg => {
        drawRoundRect(
          ctx,
          seg.x * CELL_SIZE + 2,
          seg.y * CELL_SIZE + 2,
          CELL_SIZE - 4,
          CELL_SIZE - 4,
          5  /* åœ†è§’åŠå¾„ï¼š5px */
        );
      });
    }

    /***** å·¥å…·ï¼šåœ¨ Canvas ä¸Šç»˜åˆ¶åœ†è§’çŸ©å½¢ *****/
    function drawRoundRect(ctx, x, y, width, height, radius) {
      ctx.beginPath();
      ctx.moveTo(x + radius, y);
      ctx.lineTo(x + width - radius, y);
      ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
      ctx.lineTo(x + width, y + height - radius);
      ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
      ctx.lineTo(x + radius, y + height);
      ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
      ctx.lineTo(x, y + radius);
      ctx.quadraticCurveTo(x, y, x + radius, y);
      ctx.closePath();
      ctx.fill();
    }

    /***** æ¸¸æˆç»“æŸï¼ˆå¼¹å‡ºè‡ªå®šä¹‰æ¨¡æ€æ¡†ï¼‰ *****/
    function gameOver() {
      clearInterval(gameInterval);
      if (specialTimeout) clearTimeout(specialTimeout);

      // æ›´æ–°æ¨¡æ€æ¡†å†…å®¹ï¼Œæ˜¾ç¤ºå½“å‰å¾—åˆ†
      gameOverText.textContent = 'ğŸ’¥ æ¸¸æˆç»“æŸï¼ä½ çš„å¾—åˆ†ï¼š' + score;
      // æ˜¾ç¤ºâ€œæ¸¸æˆç»“æŸâ€æ¨¡æ€æ¡†
      gameOverModal.style.display = 'flex';
    }

    /***** æ–¹å‘åˆ‡æ¢ï¼ˆé˜²æ­¢ç¬é—´åå‘è°ƒå¤´ï¼‰ *****/
    function changeDirection(newDir) {
      if ((newDir.x === -direction.x && newDir.y === 0) ||
          (newDir.y === -direction.y && newDir.x === 0)) {
        return;
      }
      direction = newDir;
    }

    /***** é”®ç›˜ç›‘å¬ *****/
    document.addEventListener('keydown', e => {
      switch (e.key) {
        case 'ArrowUp':
        case 'w':
        case 'W':
          changeDirection({ x: 0, y: -1 });
          break;
        case 'ArrowDown':
        case 's':
        case 'S':
          changeDirection({ x: 0, y: 1 });
          break;
        case 'ArrowLeft':
        case 'a':
        case 'A':
          changeDirection({ x: -1, y: 0 });
          break;
        case 'ArrowRight':
        case 'd':
        case 'D':
          changeDirection({ x: 1, y: 0 });
          break;
      }
    });

    /***** é¡µé¢æ–¹å‘æŒ‰é’® *****/
    upBtn.addEventListener('click',    () => changeDirection({ x: 0, y: -1 }));
    downBtn.addEventListener('click',  () => changeDirection({ x: 0, y: 1 }));
    leftBtn.addEventListener('click',  () => changeDirection({ x: -1, y: 0 }));
    rightBtn.addEventListener('click', () => changeDirection({ x: 1, y: 0 }));

    /***** æš‚åœ â€”â€” æ˜¾ç¤ºæ¨¡æ€æ¡†ï¼Œå†…å«â€œç»§ç»­æ¸¸æˆâ€æŒ‰é’® *****/
    pauseBtn.addEventListener('click', () => {
      if (!paused) {
        // æš‚åœæ¸¸æˆé€»è¾‘
        paused = true;
        clearInterval(gameInterval);
        pauseBtn.textContent = 'ç»§ç»­';
        // æ˜¾ç¤ºâ€œæš‚åœâ€æ¨¡æ€æ¡†
        pauseModal.style.display = 'flex';
      }
    });

    /***** â€œç»§ç»­æ¸¸æˆâ€æŒ‰é’®åŠŸèƒ½ï¼ˆéšè—æ¨¡æ€æ¡†å¹¶æ¢å¤æ¸¸æˆï¼‰ *****/
    resumeBtn.addEventListener('click', () => {
      paused = false;
      pauseBtn.textContent = 'æš‚åœ';
      pauseModal.style.display = 'none';
      // é‡æ–°å¯åŠ¨ä¸»å¾ªç¯
      gameInterval = setInterval(gameLoop, intervalTime);
    });

    /***** æ¸¸æˆç»“æŸæ¨¡æ€æ¡†ä¸­ ä¸‰ä¸ªæŒ‰é’® é‡æ–°å¼€å§‹ä¸åŒéš¾åº¦ *****/
    gameOverModal.querySelectorAll('button[data-speed]').forEach(btn => {
      btn.addEventListener('click', () => {
        const newSpeed = parseInt(btn.getAttribute('data-speed'));
        intervalTime = newSpeed;
        // éšè—æ¸¸æˆç»“æŸæ¨¡æ€æ¡†
        gameOverModal.style.display = 'none';
        // é‡æ–°åˆå§‹åŒ–æ¸¸æˆ
        initGame();
      });
    });

    // ï¼ˆæ— éœ€â€œé‡æ–°å¼€å§‹â€æŒ‰é’®é€»è¾‘ï¼Œå·²å…¨éƒ¨æ›¿æ¢æˆæ¨¡æ€æ¡†æ“ä½œï¼‰

  </script>
</body>
</html>
