<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>è´ªåƒè›‡æ¸¸æˆ</title>
  <style>
    /* æ•´ä½“èƒŒæ™¯å’Œå­—ä½“ */
    body {
      margin: 0;
      padding: 0;
      background-color: #f0f8ff; /* æµ…è“è‰²èƒŒæ™¯ */
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    /* ç™½è‰²å¡ç‰‡å®¹å™¨ */
    .container {
      background-color: #ffffff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      width: 480px; /* ä¸ç¤ºä¾‹å›¾è¿‘ä¼¼å®½åº¦ */
      padding: 20px;
    }

    /* æ ‡é¢˜ */
    .title {
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      color: #1B36C0; /* æ·±è“è‰²æ ‡é¢˜ */
    }

    /* å¾—åˆ†æ˜¾ç¤º */
    .score {
      margin-top: 10px;
      font-size: 18px;
      color: #333333;
    }

    /* æš‚åœ/é‡æ–°å¼€å§‹ æŒ‰é’®åŒº */
    .controls {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 10px;
    }
    .controls button {
      border: none;
      border-radius: 4px;
      padding: 6px 12px;
      font-size: 14px;
      cursor: pointer;
      color: #ffffff;
      outline: none;
    }
    #pauseBtn {
      background-color: #FFC107; /* é»„è‰² */
    }
    #resetBtn {
      background-color: #1B36C0; /* æ·±è“è‰² */
    }

    /* é€Ÿåº¦é€‰æ‹©åŒº */
    .speed-section {
      margin-top: 12px;
    }
    .speed-section span {
      font-size: 16px;
      color: #333333;
    }
    .speed-buttons {
      margin-top: 5px;
      display: flex;
      gap: 5px;
    }
    .speed-buttons button {
      flex: 1;
      padding: 6px 0;
      border: 1px solid #ccc;
      border-radius: 4px;
      background-color: #ffffff;
      cursor: pointer;
      font-size: 14px;
      outline: none;
    }
    .speed-buttons button.active {
      background-color: #E0E0E0;
    }

    /* é£Ÿç‰©è¯´æ˜å›¾ä¾‹ */
    .legend {
      margin-top: 15px;
      font-size: 14px;
      color: #333333;
    }
    .legend-item {
      display: flex;
      align-items: center;
      margin-top: 5px;
    }
    .legend-item .color-box {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 6px;
      display: inline-block;
    }

    /* æ¸¸æˆç”»å¸ƒå¤–æ¡† */
    .game-area {
      margin-top: 15px;
      background-color: #1B36C0; /* æ·±è“æ¸¸æˆèƒŒæ™¯ */
      border-radius: 8px;
      position: relative;
      width: 400px;
      height: 400px;
      margin-left: auto;
      margin-right: auto;
      box-shadow: inset 0 0 0 2px rgba(0,0,0,0.1);
    }
    #gameCanvas {
      display: block;
      background-color: transparent;
      margin: 0 auto;
      width: 400px;
      height: 400px;
    }

    /* æ–¹å‘æŒ‰é’®åŒº */
    .arrow-controls {
      margin-top: 15px;
      display: flex;
      justify-content: center;
    }
    .arrow-controls .row {
      display: flex;
      justify-content: center;
    }
    .arrow-controls button {
      width: 60px;
      height: 60px;
      margin: 5px;
      border: none;
      border-radius: 6px;
      background-color: #E0E0E0;
      font-size: 24px;
      cursor: pointer;
      outline: none;
      user-select: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- æ ‡é¢˜ -->
    <div class="title">è´ªåƒè›‡æ¸¸æˆ</div>

    <!-- å¾—åˆ† -->
    <div class="score">å¾—åˆ†: <span id="score">0</span></div>

    <!-- æš‚åœ & é‡æ–°å¼€å§‹ æŒ‰é’® -->
    <div class="controls">
      <button id="pauseBtn">æš‚åœ</button>
      <button id="resetBtn">é‡æ–°å¼€å§‹</button>
    </div>

    <!-- é€Ÿåº¦é€‰æ‹© -->
    <div class="speed-section">
      <span>æ¸¸æˆé€Ÿåº¦ï¼š</span>
      <div class="speed-buttons">
        <button data-speed="200">æ…¢é€Ÿ</button>
        <button data-speed="150" class="active">ä¸­é€Ÿ</button>
        <button data-speed="100">å¿«é€Ÿ</button>
        <button data-speed="50">æé€Ÿ</button>
      </div>
    </div>

    <!-- é£Ÿç‰©è¯´æ˜å›¾ä¾‹ -->
    <div class="legend">
      <div class="legend-item">
        <span class="color-box" style="background-color: red;"></span>
        æ™®é€šé£Ÿç‰© - å¾—1åˆ†
      </div>
      <div class="legend-item">
        <span class="color-box" style="background-color: yellow;"></span>
        ç‰¹æ®Šé£Ÿç‰© - å¾—3åˆ† (8ç§’åæ¶ˆå¤±)
      </div>
    </div>

    <!-- æ¸¸æˆåŒºåŸŸ -->
    <div class="game-area">
      <canvas id="gameCanvas" width="400" height="400"></canvas>
    </div>

    <!-- æ–¹å‘æŒ‰é’® -->
    <div class="arrow-controls">
      <div class="row">
        <button id="upBtn">â†‘</button>
      </div>
      <div class="row">
        <button id="leftBtn">â†</button>
        <button id="downBtn">â†“</button>
        <button id="rightBtn">â†’</button>
      </div>
    </div>
  </div>

  <script>
    /**** åŸºæœ¬å˜é‡å’Œ DOM å¼•ç”¨ ****/
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreElem = document.getElementById('score');
    const pauseBtn = document.getElementById('pauseBtn');
    const resetBtn = document.getElementById('resetBtn');
    const speedButtons = document.querySelectorAll('.speed-buttons button');

    const upBtn    = document.getElementById('upBtn');
    const downBtn  = document.getElementById('downBtn');
    const leftBtn  = document.getElementById('leftBtn');
    const rightBtn = document.getElementById('rightBtn');

    // ç½‘æ ¼è¡Œåˆ—æ•°ï¼Œä»¥åŠæ¯ä¸ªæ ¼å­çš„åƒç´ å¤§å°
    const ROWS = 20;
    const COLS = 20;
    const CELL_SIZE = canvas.width / COLS; // 400/20 = 20px

    let snake = [];               // å­˜æ”¾è›‡èº«åæ ‡çš„æ•°ç»„
    let direction = { x: 1, y: 0 }; // åˆå§‹å‘å³ç§»åŠ¨
    let food = null;              // æ™®é€šé£Ÿç‰©åæ ‡
    let specialFood = null;       // ç‰¹æ®Šé£Ÿç‰©åæ ‡
    let specialTimeout = null;    // ç”¨äºæ¸…é™¤ç‰¹æ®Šé£Ÿç‰©çš„å®šæ—¶å™¨
    let score = 0;                // å½“å‰å¾—åˆ†
    let gameInterval = null;      // æ¸¸æˆä¸»å¾ªç¯çš„ setInterval è¿”å›å€¼
    let intervalTime = 150;       // é»˜è®¤é€Ÿåº¦ï¼š150ms
    let paused = false;           // æš‚åœçŠ¶æ€æ ‡å¿—

    /**** åˆå§‹åŒ–æ¸¸æˆ ****/
    function initGame() {
      // åœæ‰å·²æœ‰çš„å¾ªç¯å’Œç‰¹æ®Šé£Ÿç‰©å®šæ—¶å™¨
      if (gameInterval) clearInterval(gameInterval);
      if (specialTimeout) clearTimeout(specialTimeout);

      // é‡ç½®å‚æ•°
      snake = [];
      // è›‡åˆå§‹é•¿åº¦ 5 æ ¼ï¼Œä½äºç”»å¸ƒä¸­å¤®
      const startX = Math.floor(COLS / 2);
      const startY = Math.floor(ROWS / 2);
      for (let i = 0; i < 5; i++) {
        snake.push({ x: startX - i, y: startY });
      }
      direction = { x: 1, y: 0 };
      score = 0;
      scoreElem.textContent = score;

      // ç”Ÿæˆç¬¬ä¸€ä¸ªæ™®é€šé£Ÿç‰©
      spawnFood();
      // å–æ¶ˆç‰¹æ®Šé£Ÿç‰©ï¼ˆè‹¥æœ‰ï¼‰
      specialFood = null;

      paused = false;
      pauseBtn.textContent = 'æš‚åœ';

      // å¯åŠ¨æ¸¸æˆå¾ªç¯
      gameInterval = setInterval(gameLoop, intervalTime);

      // å®‰æ’å®šæ—¶å™¨ï¼šåœ¨æ¸¸æˆå¼€å§‹åï¼Œæ¯éš” 12ï½18 ç§’éšæœºå‡ºç°ä¸€æ¬¡ç‰¹æ®Šé£Ÿç‰©
      scheduleSpecialSpawn();
    }

    /**** ç”Ÿæˆæ™®é€šé£Ÿç‰© ****/
    function spawnFood() {
      let valid = false;
      let x, y;
      while (!valid) {
        x = Math.floor(Math.random() * COLS);
        y = Math.floor(Math.random() * ROWS);
        // ä¿è¯é£Ÿç‰©ä¸ä¸è›‡èº«é‡å 
        valid = !snake.some(seg => seg.x === x && seg.y === y);
      }
      food = { x, y };
    }

    /**** ç”Ÿæˆç‰¹æ®Šé£Ÿç‰©ï¼Œå¹¶è®¾ç½® 8 ç§’åæ¶ˆå¤± ****/
    function spawnSpecialFood() {
      if (specialFood) return; // å¦‚æœå·²æœ‰ç‰¹æ®Šé£Ÿç‰©ï¼Œå°±ä¸å†é‡å¤ç”Ÿæˆ

      let valid = false;
      let x, y;
      while (!valid) {
        x = Math.floor(Math.random() * COLS);
        y = Math.floor(Math.random() * ROWS);
        valid = 
          !snake.some(seg => seg.x === x && seg.y === y) &&
          !(food && food.x === x && food.y === y);
      }
      specialFood = { x, y };

      // 8 ç§’åè‹¥ä»æœªè¢«åƒæ‰ï¼Œåˆ™è‡ªåŠ¨æ¶ˆå¤±
      specialTimeout = setTimeout(() => {
        specialFood = null;
        specialTimeout = null;
      }, 8000);
    }

    /**** éšæœºå®‰æ’ä¸‹ä¸€æ¬¡ç‰¹æ®Šé£Ÿç‰©çš„å‡ºç° ****/
    function scheduleSpecialSpawn() {
      // éšæœºå– 12000ï½18000 ms ä¹‹é—´çš„ä¸€ä¸ªå€¼ï¼Œé¿å…æ€»æ˜¯å›ºå®šé—´éš”
      const t = 12000 + Math.random() * 6000;
      setTimeout(() => {
        if (!specialFood) spawnSpecialFood();
        scheduleSpecialSpawn();
      }, t);
    }

    /**** æ¸¸æˆä¸»å¾ªç¯ ****/
    function gameLoop() {
      if (paused) return;

      // è®¡ç®—æ–°çš„è›‡å¤´åæ ‡
      const head = { 
        x: snake[0].x + direction.x,
        y: snake[0].y + direction.y
      };

      // è¾¹ç•Œæ£€æµ‹ï¼šç¢°åˆ°å¢™ç®—æ¸¸æˆç»“æŸ
      if (head.x < 0 || head.x >= COLS || head.y < 0 || head.y >= ROWS) {
        return gameOver();
      }
      // è‡ªèº«ç›¸æ’æ£€æµ‹
      if (snake.some(seg => seg.x === head.x && seg.y === head.y)) {
        return gameOver();
      }

      // å°†æ–°å¤´æ’å…¥åˆ°æ•°ç»„å¼€å¤´
      snake.unshift(head);

      // åˆ¤æ–­æ˜¯å¦åƒåˆ°æ™®é€šé£Ÿç‰©
      if (food && head.x === food.x && head.y === food.y) {
        score += 1;
        scoreElem.textContent = score;
        spawnFood();
      }
      // åˆ¤æ–­æ˜¯å¦åƒåˆ°ç‰¹æ®Šé£Ÿç‰©
      else if (specialFood && head.x === specialFood.x && head.y === specialFood.y) {
        score += 3;
        scoreElem.textContent = score;
        clearTimeout(specialTimeout);
        specialFood = null;
        specialTimeout = null;
      }
      else {
        // æ­£å¸¸ç§»åŠ¨ï¼Œä¸å¢é•¿ï¼šåˆ é™¤å°¾éƒ¨
        snake.pop();
      }

      // é‡æ–°ç»˜åˆ¶å…¨å±€
      drawAll();
    }

    /**** ç»˜åˆ¶å‡½æ•°ï¼šèƒŒæ™¯ã€è›‡èº«ã€é£Ÿç‰©ã€ç½‘æ ¼ï¼ˆå¯é€‰ï¼Œè‹¥æƒ³è¦ç½‘æ ¼æµ…çº¿å¯æ‰“å¼€ï¼‰ ****/
    function drawAll() {
      // æ¸…ç©ºç”»å¸ƒ
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // ï¼ˆå¯é€‰ï¼‰ç”»æµ…è‰²ç½‘æ ¼ï¼Œè‹¥ä¸éœ€è¦å¯ä»¥æ³¨é‡Šæ‰
      // ctx.strokeStyle = 'rgba(255,255,255,0.1)';
      // for (let i = 0; i <= ROWS; i++) {
      //   ctx.beginPath();
      //   ctx.moveTo(0, i * CELL_SIZE);
      //   ctx.lineTo(canvas.width, i * CELL_SIZE);
      //   ctx.stroke();
      // }
      // for (let j = 0; j <= COLS; j++) {
      //   ctx.beginPath();
      //   ctx.moveTo(j * CELL_SIZE, 0);
      //   ctx.lineTo(j * CELL_SIZE, canvas.height);
      //   ctx.stroke();
      // }

      // ç”»æ™®é€šé£Ÿç‰© (çº¢è‰²åœ†)
      if (food) {
        ctx.fillStyle = 'red';
        ctx.beginPath();
        ctx.arc(
          food.x * CELL_SIZE + CELL_SIZE / 2,
          food.y * CELL_SIZE + CELL_SIZE / 2,
          CELL_SIZE / 2 - 2,
          0, Math.PI * 2
        );
        ctx.fill();
      }

      // ç”»ç‰¹æ®Šé£Ÿç‰© (é»„è‰²åœ†)
      if (specialFood) {
        ctx.fillStyle = 'yellow';
        ctx.beginPath();
        ctx.arc(
          specialFood.x * CELL_SIZE + CELL_SIZE / 2,
          specialFood.y * CELL_SIZE + CELL_SIZE / 2,
          CELL_SIZE / 2 - 2,
          0, Math.PI * 2
        );
        ctx.fill();
      }

      // ç”»è›‡èº« (ç»¿è‰²æ–¹å—)
      ctx.fillStyle = '#00C27A';
      snake.forEach((seg, idx) => {
        ctx.fillRect(
          seg.x * CELL_SIZE + 2,
          seg.y * CELL_SIZE + 2,
          CELL_SIZE - 4,
          CELL_SIZE - 4
        );
      });
    }

    /**** æ¸¸æˆç»“æŸ ****/
    function gameOver() {
      clearInterval(gameInterval);
      if (specialTimeout) clearTimeout(specialTimeout);
      alert('ğŸ’¥ æ¸¸æˆç»“æŸï¼ä½ çš„å¾—åˆ†ï¼š' + score);
    }

    /**** æ”¹å˜æ–¹å‘ ****/
    function changeDirection(newDir) {
      // é˜²æ­¢åŸæ–¹å‘åå‘ç›´æ¥è°ƒå¤´
      if ((newDir.x === -direction.x && newDir.y === 0) ||
          (newDir.y === -direction.y && newDir.x === 0)) {
        return;
      }
      direction = newDir;
    }

    /**** ç»‘å®šé”®ç›˜äº‹ä»¶ ****/
    document.addEventListener('keydown', e => {
      switch (e.key) {
        case 'ArrowUp':
        case 'w':
        case 'W':
          changeDirection({ x: 0, y: -1 });
          break;
        case 'ArrowDown':
        case 's':
        case 'S':
          changeDirection({ x: 0, y: 1 });
          break;
        case 'ArrowLeft':
        case 'a':
        case 'A':
          changeDirection({ x: -1, y: 0 });
          break;
        case 'ArrowRight':
        case 'd':
        case 'D':
          changeDirection({ x: 1, y: 0 });
          break;
      }
    });

    /**** ç»‘å®šé¡µé¢æ–¹å‘æŒ‰é’® ****/
    upBtn.addEventListener('click',    () => changeDirection({ x: 0, y: -1 }));
    downBtn.addEventListener('click',  () => changeDirection({ x: 0, y: 1 }));
    leftBtn.addEventListener('click',  () => changeDirection({ x: -1, y: 0 }));
    rightBtn.addEventListener('click', () => changeDirection({ x: 1, y: 0 }));

    /**** æš‚åœ / ç»§ç»­ ****/
    pauseBtn.addEventListener('click', () => {
      if (!paused) {
        // æš‚åœï¼šæ¸…é™¤å¾ªç¯
        paused = true;
        clearInterval(gameInterval);
        pauseBtn.textContent = 'ç»§ç»­';
      } else {
        // ç»§ç»­ï¼šé‡æ–°å¯åŠ¨å¾ªç¯
        paused = false;
        pauseBtn.textContent = 'æš‚åœ';
        gameInterval = setInterval(gameLoop, intervalTime);
      }
    });

    /**** é‡æ–°å¼€å§‹ ****/
    resetBtn.addEventListener('click', () => {
      initGame();
    });

    /**** é€Ÿåº¦æŒ‰é’®åˆ‡æ¢ ****/
    speedButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        // å–æ¶ˆæ‰€æœ‰æŒ‰é’®çš„ active
        speedButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        intervalTime = parseInt(btn.dataset.speed);
        // å¦‚æœå½“å‰æœªæš‚åœï¼Œåˆ™ç«‹å³åˆ‡æ¢é€Ÿåº¦
        if (!paused) {
          clearInterval(gameInterval);
          gameInterval = setInterval(gameLoop, intervalTime);
        }
      });
    });

    // é¡µé¢è½½å…¥å®Œæˆåï¼Œåˆå§‹åŒ–æ¸¸æˆ
    window.onload = () => {
      initGame();
    };
  </script>
</body>
</html>
